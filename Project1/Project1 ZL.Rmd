---
title: "Project1"
output: html_document
---

```{r setup, include=FALSE}
library(NbClust)
library(factoextra)
library(dplyr)
library(stringr)
library(ClusterR)
library(plot3D)
library(plotly)
library(clValid)
```


```{r}
#loading datasets
Data1 <- read.csv('Data1.csv')
Data2 <- read.csv('Data2.csv')
Data3 <- read.csv('Data3.csv')
Data4 <- read.csv('Data4.csv')
Data5 <- read.csv('Data5.csv')
Data6 <- read.csv('Data6.csv')
Data7 <- read.csv('Data7.csv')
Data8 <- read.csv('Data8.csv')
World <- read.csv('World Indicators.csv')
```
#Task1
#dataset1
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data1[,2:4],kmeans, method="wss")
fviz_nbclust(Data1[,2:4],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=8 silhoutte suggest k=6
#set k=6
km<-kmeans(Data1[,2:4],6,nstart = 20)
Data1$cluster <- km$cluster
#external validation
external_validation(true_labels = Data1$Class, clusters = Data1$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.8585 jaccard-index=0.7639 so lets try set k=8
km<-kmeans(Data1[,2:4],8,nstart = 20)
Data1$cluster <- km$cluster
#external validation
external_validation(true_labels = Data1$Class, clusters = Data1$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=1 while jaccard-index=0.9279 so lets try k=7
km<-kmeans(Data1[,2:4],7,nstart = 20)
Data1$cluster <- km$cluster
#external validation
external_validation(true_labels = Data1$Class, clusters = Data1$cluster, method = 'jaccard_index', summary_stats = T)
#purity=1, jaccard-index=1
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data1[,2:4]))
hc.single <- hclust(dist(Data1[,2:4]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=7
```
#external validation
```{r}
Data1$h_cluster <- cutree(hc.single, 7)
external_validation(true_labels = Data1$Class, clusters = Data1$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=1
```
#plotting data
```{r}
#by Class
X1<-Data1$X1
X2<-Data1$X2
X3<-Data1$X3
scatter3D(X1,X2,X3,colvar = Data1$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data1$X1
X2<-Data1$X2
X3<-Data1$X3
scatter3D(X1,X2,X3,colvar = Data1$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data1$X1
X2<-Data1$X2
X3<-Data1$X3
scatter3D(X1,X2,X3,colvar = Data1$h_cluster,bty = "b2")
```
#Dataset2
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data2[,2:4],kmeans, method="wss")
fviz_nbclust(Data2[,2:4],kmeans, method="silhouette")
```

```{r}
#elbow and silhoutte suggest k=4
#set k=4
km<-kmeans(Data2[,2:4],4,nstart = 20)
Data2$cluster <- km$cluster
#external validation
external_validation(true_labels = Data2$Class, clusters = Data2$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.9307 jaccard-index=0.555 so lets try set k=5
km<-kmeans(Data2[,2:4],5,nstart = 20)
Data2$cluster <- km$cluster
#external validation
external_validation(true_labels = Data2$Class, clusters = Data2$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.9876 and jaccard-index=0.5849 so lets try k=6
km<-kmeans(Data2[,2:4],6,nstart = 20)
Data2$cluster <- km$cluster
#external validation
external_validation(true_labels = Data2$Class, clusters = Data2$cluster, method = 'jaccard_index', summary_stats = T)
#purity=1, jaccard-index=0.5942
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data2[,2:4]))
hc.single <- hclust(dist(Data2[,2:4]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=5
```
#external validation
```{r}
Data2$h_cluster <- cutree(hc.single, 5)
external_validation(true_labels = Data2$Class, clusters = Data2$h_cluster, method = 'jaccard_index', summary_stats = T)
```
#plotting data
```{r}
#by Class
X1<-Data2$X
X2<-Data2$Y
X3<-Data2$C
scatter3D(X1,X2,X3,colvar = Data2$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data2$X
X2<-Data2$Y
X3<-Data2$C
scatter3D(X1,X2,X3,colvar = Data2$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data2$X
X2<-Data2$Y
X3<-Data2$C
scatter3D(X1,X2,X3,colvar = Data2$h_cluster,bty = "b2")
```
#Dataset3
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data3[,2:4],kmeans, method="wss")
fviz_nbclust(Data3[,2:4],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=4 silhoutte suggest k=4
#set k=4
km<-kmeans(Data3[,2:4],4,nstart = 20)
Data3$cluster <- km$cluster
#external validation
external_validation(true_labels = Data3$Class, clusters = Data3$cluster, method = 'jaccard_index', summary_stats = T)
#purity=1, jaccard-index=1
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data3[,2:4]))
hc.single <- hclust(dist(Data3[,2:4]), method = 'centroid')
plot(hc.single)
#by the graph we know set cluster=4
```
#external validation
```{r}
Data3$h_cluster <- cutree(hc.single, 4)
external_validation(true_labels = Data3$Class, clusters = Data3$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=0.98 jaccard-index=0.952
```
#plotting data
```{r}
#by Class
X1<-Data3$X1
X2<-Data3$X2
X3<-Data3$X3
scatter3D(X1,X2,X3,colvar = Data3$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data3$X1
X2<-Data3$X2
X3<-Data3$X3
scatter3D(X1,X2,X3,colvar = Data3$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data3$X1
X2<-Data3$X2
X3<-Data3$X3
scatter3D(X1,X2,X3,colvar = Data3$h_cluster,bty = "b2")
```
#Dataset4
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data4[,2:4],kmeans, method="wss")
fviz_nbclust(Data4[,2:4],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=2 silhoutte suggest k=8
#set k=2
km<-kmeans(Data4[,2:4],2,nstart = 20)
Data4$cluster <- km$cluster
#external validation
external_validation(true_labels = Data4$Class, clusters = Data4$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.653 jaccard-index=0.3754 so lets try set k=8
km<-kmeans(Data4[,2:4],8,nstart = 20)
Data4$cluster <- km$cluster
#external validation
external_validation(true_labels = Data4$Class, clusters = Data4$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=1 while jaccard-index=0.2522 so lets try k=5
km<-kmeans(Data4[,2:4],5,nstart = 20)
Data4$cluster <- km$cluster
#external validation
external_validation(true_labels = Data4$Class, clusters = Data4$cluster, method = 'jaccard_index', summary_stats = T)
#purity=0.815, jaccard-index=0.2953 the prutiy job with minor increase in jaccard-index so we set k = 8
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data4[,2:4]))
hc.single <- hclust(dist(Data4[,2:4]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=2
```
#external validation
```{r}
Data4$h_cluster <- cutree(hc.single, 2)
external_validation(true_labels = Data4$Class, clusters = Data4$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=1
```
#plotting data
```{r}
#by Class
X1<-Data4$X1
X2<-Data4$X2
X3<-Data4$X3
scatter3D(X1,X2,X3,colvar = Data4$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data4$X1
X2<-Data4$X2
X3<-Data4$X3
scatter3D(X1,X2,X3,colvar = Data4$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data4$X1
X2<-Data4$X2
X3<-Data4$X3
scatter3D(X1,X2,X3,colvar = Data4$h_cluster,bty = "b2")
```
#Dataset5
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data5[,2:4],kmeans, method="wss")
fviz_nbclust(Data5[,2:4],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=10 silhoutte suggest k=10
#set k=10
km<-kmeans(Data5[,2:4],10,nstart = 20)
Data5$cluster <- km$cluster
#external validation
external_validation(true_labels = Data5$Class, clusters = Data5$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=1 jaccard-index=0.5601 while their is a huge step in silhoutte so lets try set k=2
km<-kmeans(Data5[,2:4],2,nstart = 20)
Data5$cluster <- km$cluster
#external validation
external_validation(true_labels = Data5$Class, clusters = Data5$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.7175 jaccard-index=0.4811 both dropped so lets keep k=10
km<-kmeans(Data5[,2:4],10,nstart = 20)
Data5$cluster <- km$cluster
#external validation
external_validation(true_labels = Data5$Class, clusters = Data5$cluster, method = 'jaccard_index', summary_stats = T)
#purity=1, jaccard-index=0.5601
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data5[,2:4]))
hc.single <- hclust(dist(Data5[,2:4]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=2
```
#external validation
```{r}
Data5$h_cluster <- cutree(hc.single, 2)
external_validation(true_labels = Data5$Class, clusters = Data5$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=1
```
#plotting data
```{r}
#by Class
X1<-Data5$X1
X2<-Data5$X2
X3<-Data5$X3
scatter3D(X1,X2,X3,colvar = Data5$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data5$X1
X2<-Data5$X2
X3<-Data5$X3
scatter3D(X1,X2,X3,colvar = Data5$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data5$X1
X2<-Data5$X2
X3<-Data5$X3
scatter3D(X1,X2,X3,colvar = Data5$h_cluster,bty = "b2")
```
#Dataset6
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data6[,2:3],kmeans, method="wss")
fviz_nbclust(Data6[,2:3],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=3 silhoutte suggest k=3
#set k=3
km<-kmeans(Data6[,2:3],3,nstart = 20)
Data6$cluster <- km$cluster
#external validation
external_validation(true_labels = Data6$Class, clusters = Data6$cluster, method = 'jaccard_index', summary_stats = T)
```

```{r}
#purity=0.9321 jaccard-index=0.5908  there is a huge step in silhoutte so lets try set k=2
km<-kmeans(Data6[,2:3],2,nstart = 20)
Data6$cluster <- km$cluster
#external validation
external_validation(true_labels = Data6$Class, clusters = Data6$cluster, method = 'jaccard_index', summary_stats = T)
#purity=9514 while jaccard-index=0.8309 which is higher than k=3 so keep k=2
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data6[,2:3]))
hc.single <- hclust(dist(Data6[,2:3]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=2
```
#external validation
```{r}
Data6$h_cluster <- cutree(hc.single, 2)
external_validation(true_labels = Data6$Class, clusters = Data6$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=0.5005 jaccard-index=0.4996
```
#plotting data
```{r}
#by Class
X1<-Data6$X1
X2<-Data6$X2
scatter2D(X1,X2,colvar = Data6$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data6$X1
X2<-Data6$X2
scatter2D(X1,X2,colvar = Data6$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data6$X1
X2<-Data6$X2
scatter2D(X1,X2,colvar = Data6$h_cluster,bty = "b2")
```
#Dataset7
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data7[,2:3],kmeans, method="wss")
fviz_nbclust(Data7[,2:3],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=6 silhoutte suggest k=6
#set k=6
km<-kmeans(Data7[,2:4],6,nstart = 20)
Data7$cluster <- km$cluster
#external validation
external_validation(true_labels = Data7$Class, clusters = Data7$cluster, method = 'jaccard_index', summary_stats = T)
#purity=0.9844 jaccard-index=0.6311 so lets try set k=8
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data7[,2:3]))
hc.single <- hclust(dist(Data7[,2:3]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=6
```
#external validation
```{r}
Data7$h_cluster <- cutree(hc.single, 6)
external_validation(true_labels = Data7$Class, clusters = Data7$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=1
```
#plotting data
```{r}
#by Class
X1<-Data7$X1
X2<-Data7$X2
scatter2D(X1,X2,colvar = Data7$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data7$X1
X2<-Data7$X2
scatter2D(X1,X2,colvar = Data7$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data7$X1
X2<-Data7$X2
scatter2D(X1,X2,colvar = Data7$h_cluster,bty = "b2")
```
#Dataset8
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(Data8[,2:4],kmeans, method="wss")
fviz_nbclust(Data8[,2:4],kmeans, method="silhouette")
```

```{r}
#silhouette suggest k=6
#set k=6
km<-kmeans(Data8[,2:4],6,nstart = 20)
Data8$cluster <- km$cluster
#external validation
external_validation(true_labels = Data8$Class, clusters = Data8$cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=0.1665 since there is no a good suggestion picked in elbow, we could check in the visualization
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(Data8[,2:4]))
hc.single <- hclust(dist(Data8[,2:4]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=2
```
#external validation
```{r}
Data8$h_cluster <- cutree(hc.single, 2)
external_validation(true_labels = Data8$Class, clusters = Data8$h_cluster, method = 'jaccard_index', summary_stats = T)
#purity=1 jaccard-index=0.9995
```
#plotting data
```{r}
#by Class
X1<-Data8$X1
X2<-Data8$X2
X3<-Data8$X3
scatter3D(X1,X2,X3,colvar = Data8$Class,bty = "b2")
```

```{r}
#by kmeans
X1<-Data8$X1
X2<-Data8$X2
X3<-Data8$X3
scatter3D(X1,X2,X3,colvar = Data8$cluster,bty = "b2")
```

```{r}
#by hierarchy clustering
X1<-Data8$X1
X2<-Data8$X2
X3<-Data8$X3
scatter3D(X1,X2,X3,colvar = Data8$h_cluster,bty = "b2")
```
#Task2
#clean data since there are lots og NAs and simples
```{r}
summary(World)
#Remove commas and $ from GDP and Capita columns
World$GDP <- as.factor(gsub(",", "", World$GDP))
World$GDP <- as.numeric(gsub("\\$", "", World$GDP))
World$Health.Exp.Capita <- as.factor(gsub(",", "", World$Health.Exp.Capita))
World$Health.Exp.Capita <- as.numeric(gsub("\\$", "", World$Health.Exp.Capita))
#Remove % from Tax rate column
World$Business.Tax.Rate <- as.numeric(sub("%", "",World$Business.Tax.Rate))
scaled_World <- scale(World[, 1:18])
scaled_World2 <- World[,1:18] %>%
                      mutate_all(~(scale(.) %>% as.vector))
scaled_World2$Region <-  World$Region
scaled_World2$Country <- World$Country
#Remove energy usage and lending interest as they have high number of NAs
scaled_World2 <- scaled_World2 %>%
                        select(-Energy.Usage, -Lending.Interest)
scaled_World_NA <- na.omit(scaled_World2)
```
#Analyze
```{r}
#check with fvis with elbow and silhouette methods
fviz_nbclust(scaled_World_NA[,1:16],kmeans, method="wss")
fviz_nbclust(scaled_World_NA[,1:16],kmeans, method="silhouette")
```

```{r}
#elbow suggest k=2 silhoutte suggest k=2
#set k=2
km<-kmeans(scaled_World_NA[,1:16],2,nstart = 20)
scaled_World_NA$cluster <- km$cluster
World_valid <- scaled_World_NA %>%
                        select(-Region,-Country)
inter<-clValid(World_valid,2,clMethds = c("hierarchical","kmeans"),validation="internal")
summary(inter)
```
#hierachy clustering
```{r}
dist_matrix <- as.matrix(dist(scaled_World_NA[,1:16]))
hc.single <- hclust(dist(scaled_World_NA[,1:16]), method = 'single')
plot(hc.single)
#by the graph we know set cluster=2
```
#internal validation
```{r}
scaled_World_NA$h_cluster <- cutree(hc.single, 2)
inter<-clValid(World_valid,2,clMethds = c("hierarchical","kmeans"),validation="internal")
summary(inter)
```
#report solution
```{r}
subset(scaled_World_NA,cluster==1,select = c(Region,Country))
subset(scaled_World_NA,cluster==2,select = c(Region,Country))
```
#plotting data
```{r}
#by Class
X1<-scaled_World_NA$GDP
X2<-scaled_World_NA$Birth.Rate
scatter2D(X1,X2,xlab="GDP",ylab="Birth rate",colvar = scaled_World_NA$cluster,bty = "b2")
```
